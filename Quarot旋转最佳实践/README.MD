修复qwen3-vl仅对LLM进行旋转的问题：

修改前：

```python3
if process_word_embeddings:
	model.lm_head.weight.data = model.language_model.embed_tokens.weight.data.clone()
```

修改后：

```python
if process_word_embeddings:
    print("开始处理tie_embedding")
    model.lm_head.weight = torch.nn.Parameter(
        model.language_model.embed_tokens.weight.data.clone().detach(),
        requires_grad=False
    )

print(f"复制后 - embed_tokens地址: {model.language_model.embed_tokens.weight.data.data_ptr()}")
print(f"复制后 - lm_head地址: {model.lm_head.weight.data.data_ptr()}")
print(f"复制后 - 是否共享内存: {model.lm_head.weight.data.data_ptr() == model.language_model.embed_tokens.weight.data.data_ptr()}")
```

结果：

```shell
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00, 16.11it/s]
========== SAMPLE GENERATION ==============
<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant

<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant
这是一个非常有趣、带点幽默和“脑洞大开”的问题！😄

“老婆饼”之所以叫“老婆饼”，并不是因为饼里真的有“老婆”，而是因为**“老婆”是“老婆饼”的名字来源，跟“老婆”这个字的“人”字有关，是民间对“老婆饼”这一食物的亲切称呼**。

具体来说：

✅ **“老婆”是“老婆饼”的名字**  
“老婆饼”是广东传统点心，最早在清朝末年或民国时期流行，因饼皮酥松、内馅甜软，常被当作“给老婆吃的饼”，所以叫“老婆饼”。  
—— 本质上是“给老婆吃的饼”，不是“饼里有老婆”。

✅ **“老婆”是“老婆饼”的“人”字旁**  
“老婆”二字在粤语中常被用作对“妻子”的亲昵称呼，如“老婆辛苦啦”、“老婆饼要趁热吃”，所以“老婆饼”是“给老婆吃的饼”，不是“饼里有老婆”。

✅ **“饼里没有老婆”是常识**  
当然，饼里没有老婆，只有馅料——通常是豆沙、莲蓉、咸蛋黄、肉松、花生碎、或各种甜馅，外皮是酥皮，咬一口酥到掉渣，甜到心坎里。

✅ **“老婆饼”是“老婆”的“饼”**  
这名字其实是“人+饼”的组合，是“人”的“饼”，不是“饼”的“人”——所以“饼里没有老婆”，但“饼是给老婆吃的”。

---

🎯 总结一下：

> **老婆饼里没有老婆，是因为“老婆”是名字，不是馅料。**  
> 它是“给老婆吃的饼”，是“人”的“饼”，不是“饼”的“人”。

——所以，下次你吃老婆饼时，可以对自己说：“这饼是给老婆吃的，不是给老婆的馅料的！” 😄

（不过，如果你老婆吃了这个饼，她可能会说：“这饼是给我的，你别偷吃！”）

---

📌 小彩蛋：  
“老婆饼”其实还有个“反向梗”——  
“老婆饼里没有老婆，但有‘老婆’的味道！”  
—— 甜到心里，暖到窝里，就是“老婆饼”的魅力！

---


==========================================
开始处理tie_embedding
复制后 - embed_tokens地址: 139677671620608
复制后 - lm_head地址: 139669081686016
复制后 - 是否共享内存: False
开始合并 RMSNorm 参数...
torch.Size([2560])
torch.Size([151936, 2560])
RMSNorm 参数合并完成！
========== SAMPLE GENERATION ==============
<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant

<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant
这是一个非常有趣、带点幽默感的问题！😄

“老婆饼”这个名字听起来确实有点“玄学”——“老婆”是“妻子”的意思，但饼里当然没有老婆，因为：

🍪 **饼是饼，老婆是人，它们不在同一个维度**  
——除非你老婆特别爱吃饼，那她可能会“住在”饼里，但那属于“情感投射”范畴，不是物理现实 😄

🥮 **名字是“老婆饼”，不是“老婆饼”**  
——“老婆”是“称呼”，是“人名”或“代称”，就像“红烧肉”里没有“红烧”、“肉”里没有“肉”一样。  
“老婆饼”是**一种传统中式点心**，名字来源于“老婆”这个称呼，是**对老婆的爱称**，用来表达“给老婆做的饼”、“给老婆吃的好饼”。

👩‍🍳 **历史渊源**  
老婆饼最早起源于广东，是传统点心之一，外皮酥松，内馅是咸甜的豆沙或莲蓉，有时还加糖、花生、芝麻等。  
“老婆饼”这个名字，其实是**民间对“给妻子做的饼”的一种浪漫称呼**，寓意“饼里藏着对老婆的爱”——虽然饼里没有老婆，但有“老婆的爱”。

💡 **总结一下：**
> **老婆饼里没有老婆，是因为老婆是人，饼是饼，它们不在同一个物理空间。**  
> 但“老婆饼”这个名字，是**对妻子的爱意和甜蜜的象征**，吃一口，就是吃一口“爱的味道”！

所以，下次你老婆吃老婆饼，记得说：“这是你最爱吃的饼，里面藏着我的爱～” ❤️ 

（PS：如果真想让老婆“住在”饼里，建议把饼做厚点，加点糖，再配上一句“你是我心尖上的饼” 😄）<|im_end|>
==========================================
2560 128 32 8
2025-12-18 08:07:17.914 | INFO     | __main__:<module>:220 - 开始将旋转矩阵 R1 合并到模型权重中...
tensor([[ 1.0000e+00, -1.6353e-20, -1.6353e-20,  ..., -1.6353e-20,
         -1.6353e-20, -3.7857e-20],
        [-1.6353e-20,  1.0000e+00,  3.7857e-20,  ...,  2.0049e-19,
          3.7857e-20,  1.6353e-20],
        [-1.6353e-20,  3.7857e-20,  1.0000e+00,  ...,  3.7857e-20,
          2.0049e-19,  1.6353e-20],
        ...,
        [-1.6353e-20,  2.0049e-19,  3.7857e-20,  ...,  1.0000e+00,
          3.7857e-20,  1.6353e-20],
        [-1.6353e-20,  3.7857e-20,  2.0049e-19,  ...,  3.7857e-20,
          1.0000e+00,  1.6353e-20],
        [-3.7857e-20,  1.6353e-20,  1.6353e-20,  ...,  1.6353e-20,
          1.6353e-20,  1.0000e+00]], device='cuda:0', dtype=torch.float64)
2025-12-18 08:07:18.017 | INFO     | __main__:<module>:243 - 已合并 Embedding 层。
2025-12-18 08:07:18.144 | INFO     | __main__:<module>:268 - 已合并 Block 1/36 的权重。
2025-12-18 08:07:18.144 | INFO     | __main__:<module>:268 - 已合并 Block 2/36 的权重。
2025-12-18 08:07:18.145 | INFO     | __main__:<module>:268 - 已合并 Block 3/36 的权重。
2025-12-18 08:07:18.145 | INFO     | __main__:<module>:268 - 已合并 Block 4/36 的权重。
2025-12-18 08:07:18.146 | INFO     | __main__:<module>:268 - 已合并 Block 5/36 的权重。
2025-12-18 08:07:18.146 | INFO     | __main__:<module>:268 - 已合并 Block 6/36 的权重。
2025-12-18 08:07:18.147 | INFO     | __main__:<module>:268 - 已合并 Block 7/36 的权重。
2025-12-18 08:07:18.147 | INFO     | __main__:<module>:268 - 已合并 Block 8/36 的权重。
2025-12-18 08:07:18.148 | INFO     | __main__:<module>:268 - 已合并 Block 9/36 的权重。
2025-12-18 08:07:18.148 | INFO     | __main__:<module>:268 - 已合并 Block 10/36 的权重。
2025-12-18 08:07:18.148 | INFO     | __main__:<module>:268 - 已合并 Block 11/36 的权重。
2025-12-18 08:07:18.149 | INFO     | __main__:<module>:268 - 已合并 Block 12/36 的权重。
2025-12-18 08:07:18.149 | INFO     | __main__:<module>:268 - 已合并 Block 13/36 的权重。
2025-12-18 08:07:18.150 | INFO     | __main__:<module>:268 - 已合并 Block 14/36 的权重。
2025-12-18 08:07:18.150 | INFO     | __main__:<module>:268 - 已合并 Block 15/36 的权重。
2025-12-18 08:07:18.151 | INFO     | __main__:<module>:268 - 已合并 Block 16/36 的权重。
2025-12-18 08:07:18.151 | INFO     | __main__:<module>:268 - 已合并 Block 17/36 的权重。
2025-12-18 08:07:18.152 | INFO     | __main__:<module>:268 - 已合并 Block 18/36 的权重。
2025-12-18 08:07:18.152 | INFO     | __main__:<module>:268 - 已合并 Block 19/36 的权重。
2025-12-18 08:07:18.152 | INFO     | __main__:<module>:268 - 已合并 Block 20/36 的权重。
2025-12-18 08:07:18.153 | INFO     | __main__:<module>:268 - 已合并 Block 21/36 的权重。
2025-12-18 08:07:18.153 | INFO     | __main__:<module>:268 - 已合并 Block 22/36 的权重。
2025-12-18 08:07:18.154 | INFO     | __main__:<module>:268 - 已合并 Block 23/36 的权重。
2025-12-18 08:07:18.154 | INFO     | __main__:<module>:268 - 已合并 Block 24/36 的权重。
2025-12-18 08:07:18.155 | INFO     | __main__:<module>:268 - 已合并 Block 25/36 的权重。
2025-12-18 08:07:18.155 | INFO     | __main__:<module>:268 - 已合并 Block 26/36 的权重。
2025-12-18 08:07:18.156 | INFO     | __main__:<module>:268 - 已合并 Block 27/36 的权重。
2025-12-18 08:07:18.156 | INFO     | __main__:<module>:268 - 已合并 Block 28/36 的权重。
2025-12-18 08:07:18.156 | INFO     | __main__:<module>:268 - 已合并 Block 29/36 的权重。
2025-12-18 08:07:18.157 | INFO     | __main__:<module>:268 - 已合并 Block 30/36 的权重。
2025-12-18 08:07:18.157 | INFO     | __main__:<module>:268 - 已合并 Block 31/36 的权重。
2025-12-18 08:07:18.158 | INFO     | __main__:<module>:268 - 已合并 Block 32/36 的权重。
2025-12-18 08:07:18.158 | INFO     | __main__:<module>:268 - 已合并 Block 33/36 的权重。
2025-12-18 08:07:18.159 | INFO     | __main__:<module>:268 - 已合并 Block 34/36 的权重。
2025-12-18 08:07:18.159 | INFO     | __main__:<module>:268 - 已合并 Block 35/36 的权重。
2025-12-18 08:07:18.160 | INFO     | __main__:<module>:268 - 已合并 Block 36/36 的权重。
2025-12-18 08:07:18.161 | INFO     | __main__:<module>:273 - 已合并 LM Head。
2025-12-18 08:07:18.161 | INFO     | __main__:<module>:275 - 旋转合并后模型推理：
========== SAMPLE GENERATION ==============
<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant

<|im_start|>user
老婆饼里面为什么没有老婆<|im_end|>
<|im_start|>assistant
这是一个非常有趣、带点幽默感的问题！😄

“老婆饼”这个名字听起来确实有点“玄学”——“老婆”在中文里是“妻子”的意思，但饼里当然没有老婆，因为：

1. **名字是“拟人化”+“谐音梗”**  
   “老婆饼”是粤语地区（尤其是广东）流传已久的一种传统点心，名字来源于“老婆”二字的“谐音”或“拟人化”——因为饼的形状圆圆的，像“老婆”（在粤语中“老婆”常被形容为“圆圆的”或“圆满的”），或者更直接地说，是“老婆”（妻子）的“谐音”“老婆”→“老婆饼”，寓意“老婆饼”是给“老婆”吃的，或者“老婆饼”是“老婆”（妻子）的“专属美食”。

2. **“老婆”不是字面意思**  
   在中文语境中，“老婆饼”是“老婆”+“饼”的组合，不是“老婆”这个人，而是“老婆”这个角色的象征。就像“牛肉面”不是“牛肉+面条”，而是“面”里有“牛肉”；“老婆饼”里有“饼”，但“老婆”是名字，不是实体。

3. **文化梗+幽默感**  
   这个名字本身就带点“梗”和“幽默”，很多人调侃“老婆饼里没有老婆”，其实是对名字的一种“反讽式幽默”——“老婆饼”是“老婆”吃的饼，但饼里没有“老婆”，只有“饼”和“馅料”（比如豆沙、莲蓉、咸蛋黄等）。

4. **历史来源**  
   传说“老婆饼”起源于清朝，当时有位“老婆”（妻子）喜欢吃饼，于是有人为她做了一种“饼”，后来就叫“老婆饼”。但这个“老婆”是“人”，不是“动物”或“抽象概念”，所以饼里当然没有她！

5. **现代用法**  
   现在“老婆饼”更多是“美食名称”，而不是“人名”，所以“饼里没有老婆”是“字面误解”，但“名字里有老婆”是“文化符号”。

✅ 总结：  
老婆饼里没有老婆，是因为“老婆”是“名字”，不是“
==========================================
```

